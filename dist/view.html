<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script type="text/javascript" src="./js/jquery-2.0.3.min.js"></script>

    <!-- <link href="./diypage/resource/css/common.css" rel="stylesheet"> -->
    <link
      rel="stylesheet"
      type="text/css"
      href="./diypage/resource/css/iconfont2.css"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="./diypage/resource/css/icon_diy.css"
    />

    <link
      rel="stylesheet"
      type="text/css"
      href="./diypage/resource/css/font-awesome.min.css"
    />

    <link
      href="./diypage/resource/css/diypage/web.css"
      rel="stylesheet"
      type="text/css"
    />

    <link
      href="./diypage/resource/css/diypage/diy.min.css"
      rel="stylesheet"
      type="text/css"
    />

    <link
      href="./diypage/resource/css/diypage/foxui.diy.css"
      rel="stylesheet"
      type="text/css"
    />

    <link
      rel="stylesheet"
      href="./diypage/resource/css/diypage/jquery-ui.min.css"
    />

    <style>
      html,
      body {
        width: 100%;
        padding: 0;
        border: 0;
        margin: 0;
      }
      #phone {
        width: 100%;
        overflow-x: hidden;
      }
    </style>
  </head>
  <body>
    <div class="phone" id="phone">哈哈哈</div>
    <!-- banner模板 -->
    <script type="text/html" id="tpl_show_banner">
      <div class="drag" data-itemid="<%itemid%>">
        <div
          class="diy-banner"
          style="background:<%if params.styledata==1%>url(<%params.backgroundimg%>) <%params.positiony%> <%params.positionx%><%/if%> <%style.backgroundall%>;<%if params.styledata==1%>background-repeat: <%params.repeat%>;background-size: <%if params.size==1%>cover<%/if%><%if params.size==0%><%style.sizew%>% <%style.sizeh%>%<%/if%>;<%/if%>padding:<%style.paddingtop||'0'%>px <%style.paddingleft||'0'%>px;margin-top: <%style.mt%>px"
        >
          <div style="position: relative;">
            <%each data as item%>

            <img
              src="<%item.imgurl%>"
              style="<%if params.imgh%>height:<%params.imgh%>px<%/if%>"
              onerror="this.src='./diypage/resource/images/diypage/default/banner-1.jpg'"
            />

            <%/each%> <%if params.navstyle==0%>

            <div
              class="dots center round"
              style="bottom: <%style.bottom||'10'%>px; opacity: <%style.opacity||'0.8'%>;"
            >
              <%each data as item%>

              <span
                style="background: <%style.background||'#000000'%>;margin: 0 <%style.leftright/2||'10'%>px;"
              ></span>

              <%/each%>
            </div>

            <%/if%> <%if params.navstyle==1%> <%each data as item%>

            <div
              style="position: absolute;color: <%style.text_color%>;padding: <%style.pdh||'5'%>px <%style.pdw||'10'%>px;background-color: <%style.bg%>;left: 0;right: 0;bottom: 0;"
            >
              <%item.text%>

              <div style="float: right; color: <%style.text_color%>">
                <span style="color:<%style.jsq_color%>"><%item.single%></span
                >/<%params.totle%>
              </div>
            </div>

            <%/each%> <%/if%> <%if params.navstyle2==1%>

            <div
              style="height: 100%;width: 10px;position: absolute;overflow: hidden;left: 0;top: 0"
            >
              <img
                style="height: 100%"
                src="./diypage//template/diy/resource/images/diypage/default/goods-4.jpg"
              />
            </div>

            <div
              style="height: 100%;width: 10px;position: absolute;overflow: hidden;right:0;top: 0"
            >
              <img
                style="height: 100%"
                src="./diypage//template/diy/resource/images/diypage/default/goods-4.jpg"
              />
            </div>

            <%/if%>
          </div>
        </div>
      </div>
    </script>
    <!-- 按钮组模板 -->
    <script type="text/html" id="tpl_show_menu">
      <div class="drag" data-itemid="<%itemid%>">
        <%if data==''%>

        <div class="nochild">您还没有添加图标</div>

        <%else%>

        <div
          class="fui-icon-group noborder col-<%style.rownum%> <%style.navstyle%> <%if style.showtype>0%>pb10<%/if%>"
          style="background:<%if params.styledata==1%>url(<%params.backgroundimg%>) <%params.positiony%> <%params.positionx%><%/if%> <%style.background%>;<%if params.styledata==1%>background-repeat: <%params.repeat%>;background-size: <%if params.size==1%>cover<%/if%><%if params.size==0%><%style.sizew%>% <%style.sizeh%>%<%/if%>;<%/if%>padding:<%style.padding||0%>px <%style.paddingleft||0%>px;margin-top: <%style.mt%>px"
        >
          <%each data as item%>

          <div class="fui-icon-col">
            <%if params.picicon==1%><img
              src="<%item.imgurl%>"
              style="display: block;margin: 0 auto;height:<%style.imgwidth||'47'%>px;width: <%style.imgwidth||'47'%>px;max-width: 100%"
            /><%/if%>
            <!-- <%if params.picicon==2%><div class="iconfont <%item.icon%>" style="font-size: <%style.iconfz%>px;color: <%style.iconcolor%>"></div><%/if%> -->
            <%if params.picicon==2%>
            <span
              class="iconfont <%item.iconclass%>"
              style="margin:8px auto 0;box-sizing:content-box;display:block;font-size: <%style.iconfont%>px;padding:<%style.paddingtop||'0'%>px 0;width:<%style.iconfont%>px;height:<%style.iconfont%>px;line-height: <%style.iconfont%>px;"
            ></span>
            <%/if%>

            <div
              class="text"
              style="color: <%item.color%>;display: <%if params.textshow==2 %>none<%/if%>"
            >
              <%item.text%>
            </div>
          </div>

          <%/each%> <%if style.showdot>0&&style.showtype==1%>

          <div class="fui-icon-group-pagination">
            <a class="active"></a>

            <a></a>
          </div>

          <%/if%>
        </div>

        <%/if%>
      </div>
    </script>
    <!--搜索框-->

    <script type="text/html" id="tpl_show_ssk">
      <div class="drag" data-itemid="<%itemid%>">
        <div
          style="background:<%if params.styledata==1%>url(<%params.backgroundimg%>) <%params.positiony%> <%params.positionx%><%/if%> <%style.background%>;<%if params.styledata==1%>background-repeat: <%params.repeat%>;background-size: <%if params.size==1%>cover<%/if%><%if params.size==0%><%style.sizew%>% <%style.sizeh%>%<%/if%>;<%/if%>padding: <%style.boxpdh%>px <%style.boxpdz%>px;margin-top: <%style.mt%>px"
        >
          <input
            type="text"
            name=""
            id=""
            value="请输入关键词"
            style="width:100%;border:1px solid #ccc;font-size:<%style.fontsize%>px;text-align:<%style.textalign%>;border-radius: <%style.borderradius%>px;background: <%style.bg%>;padding:<%style.padding%>px;color: <%style.color%>"
          />
        </div>
      </div>
    </script>
    <!-- 富文本 -->
    <script type="text/html" id="tpl_show_richtext">
      <div class="drag" data-itemid="<%itemid%>">
        <div
          class="diy-richtext"
          style="background: <%style.background%>; padding: <%style.padding%>px;margin-top: <%style.margintop%>px"
        >
          <%if params.content%> <%=decode(params.content)%> <%else%>

          <p style="font-size:12px;color:#838383;line-height:20px;">
            1.对文字进行加粗、斜体、下划线、删除线、文字颜色、背景色、以及字号大小等简单排版操作。
          </p>
          <p style="font-size:12px;color:#838383;line-height:20px;">
            2.添加表格，如中奖客户、发放奖品、备注、猪猪、内测码、已经发放、大麦、积分、领取地址。
          </p>
          <p style="font-size:12px;color:#838383;line-height:20px;">
            3.插入图片，图片可以加上超链接，方便用户点击。
          </p>

          <%/if%>
        </div>
      </div>
    </script>

    <!--直播 -->
    <script type="text/html" id="tpl_show_video">
      <div
        class="drag live-room"
        data-liveId="<%params.liveId%>"
        data-channelId="<%params.channelId%>"
        style="padding:<%style.paddingtop||'0'%>px <%style.paddingleft%>px;background:<%if params.styledata==1%>url(<%params.backgroundimg%>) <%params.positiony%> <%params.positionx%><%/if%> <%style.background%>;<%if params.styledata==1%>background-repeat: <%params.repeat%>;background-size: <%if params.size==1%>cover<%/if%><%if params.size==0%><%style.sizew%>% <%style.sizeh%>%<%/if%>;<%/if%>margin-top: <%style.mt%>px"
      >
        <div
          class="diy-video style<%style.ratio%>"
          style='background-image: url("<%imgsrc(params.poster) || "./diypage/resource/images/diypage/default/videoplay.png"%>")'
        ></div>
      </div>
    </script>
    <script
      type="text/javascript"
      src="./diypage/resource/js/require.js"
    ></script>
    <script>
      jQuery.base64 = (function ($) {
        var _PADCHAR = "=",
          _ALPHA =
            "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",
          _VERSION = "1.1";

        function _getbyte64(s, i) {
          var idx = _ALPHA.indexOf(s.charAt(i));

          if (idx === -1) {
            throw "Cannot decode base64";
          }

          return idx;
        }

        function _decode_chars(y, x) {
          while (y.length > 0) {
            var ch = y[0];

            if (ch < 0x80) {
              y.shift();

              x.push(String.fromCharCode(ch));
            } else if ((ch & 0x80) == 0xc0) {
              if (y.length < 2) break;

              ch = y.shift();

              var ch1 = y.shift();

              x.push(String.fromCharCode(((ch & 0x1f) << 6) + (ch1 & 0x3f)));
            } else {
              if (y.length < 3) break;

              ch = y.shift();

              var ch1 = y.shift();

              var ch2 = y.shift();

              x.push(
                String.fromCharCode(
                  ((ch & 0x0f) << 12) + ((ch1 & 0x3f) << 6) + (ch2 & 0x3f)
                )
              );
            }
          }
        }

        function _decode(s) {
          var pads = 0,
            i,
            b10,
            imax = s.length,
            x = [],
            y = [];

          s = String(s);

          if (imax === 0) {
            return s;
          }

          if (imax % 4 !== 0) {
            throw "Cannot decode base64";
          }

          if (s.charAt(imax - 1) === _PADCHAR) {
            pads = 1;

            if (s.charAt(imax - 2) === _PADCHAR) {
              pads = 2;
            }

            imax -= 4;
          }

          for (i = 0; i < imax; i += 4) {
            var ch1 = _getbyte64(s, i);

            var ch2 = _getbyte64(s, i + 1);

            var ch3 = _getbyte64(s, i + 2);

            var ch4 = _getbyte64(s, i + 3);

            b10 =
              (_getbyte64(s, i) << 18) |
              (_getbyte64(s, i + 1) << 12) |
              (_getbyte64(s, i + 2) << 6) |
              _getbyte64(s, i + 3);

            y.push(b10 >> 16);

            y.push((b10 >> 8) & 0xff);

            y.push(b10 & 0xff);

            _decode_chars(y, x);
          }

          switch (pads) {
            case 1:
              b10 =
                (_getbyte64(s, i) << 18) |
                (_getbyte64(s, i + 1) << 12) |
                (_getbyte64(s, i + 2) << 6);

              y.push(b10 >> 16);

              y.push((b10 >> 8) & 0xff);

              break;

            case 2:
              b10 = (_getbyte64(s, i) << 18) | (_getbyte64(s, i + 1) << 12);

              y.push(b10 >> 16);

              break;
          }

          _decode_chars(y, x);

          if (y.length > 0) throw "Cannot decode base64";

          return x.join("");
        }

        function _get_chars(ch, y) {
          if (ch < 0x80) y.push(ch);
          else if (ch < 0x800) {
            y.push(0xc0 + ((ch >> 6) & 0x1f));

            y.push(0x80 + (ch & 0x3f));
          } else {
            y.push(0xe0 + ((ch >> 12) & 0xf));

            y.push(0x80 + ((ch >> 6) & 0x3f));

            y.push(0x80 + (ch & 0x3f));
          }
        }

        function _encode(s) {
          if (arguments.length !== 1) {
            throw "SyntaxError: exactly one argument required";
          }

          s = String(s);

          if (s.length === 0) {
            return s;
          }

          var i,
            b10,
            y = [],
            x = [],
            len = s.length;

          i = 0;

          while (i < len) {
            _get_chars(s.charCodeAt(i), y);

            while (y.length >= 3) {
              var ch1 = y.shift();

              var ch2 = y.shift();

              var ch3 = y.shift();

              b10 = (ch1 << 16) | (ch2 << 8) | ch3;

              x.push(_ALPHA.charAt(b10 >> 18));

              x.push(_ALPHA.charAt((b10 >> 12) & 0x3f));

              x.push(_ALPHA.charAt((b10 >> 6) & 0x3f));

              x.push(_ALPHA.charAt(b10 & 0x3f));
            }

            i++;
          }

          switch (y.length) {
            case 1:
              var ch = y.shift();

              b10 = ch << 16;

              x.push(
                _ALPHA.charAt(b10 >> 18) +
                  _ALPHA.charAt((b10 >> 12) & 0x3f) +
                  _PADCHAR +
                  _PADCHAR
              );

              break;

            case 2:
              var ch1 = y.shift();

              var ch2 = y.shift();

              b10 = (ch1 << 16) | (ch2 << 8);

              x.push(
                _ALPHA.charAt(b10 >> 18) +
                  _ALPHA.charAt((b10 >> 12) & 0x3f) +
                  _ALPHA.charAt((b10 >> 6) & 0x3f) +
                  _PADCHAR
              );

              break;
          }

          return x.join("");
        }

        return {
          decode: _decode,

          encode: _encode,

          VERSION: _VERSION,
        };
      })(jQuery);
    </script>
    <script>
      var tpl = "./diypage/resource/js/app/tpl.js";
      $('body').delegate('.live-room','click',function(e){
        var tar = $(e.currentTarget)
        var liveId = tar.attr('data-liveId')
        var channelId = tar.attr('data-channelId')
        console.log(liveId)
        $.ajax({
          url:'/api/enterprise/live/liveDetail',
          data:{
            liveId
          },
          method:'GET',
          success:function(res) {
            console.log(res)
            if(res.status===200) {
              if(res.data.status=='live') {
                location.href = 'https://live.polyv.cn/watch/'+channelId
              }
            }
          }
        })
      })

      function query2Object(query) {
        if (query.indexOf("?") > -1) {
          query = query.slice(1);
        }
        var obj = {};
        if (query.indexOf("&") > -1) {
          var arr = query.split("&");
          arr.forEach(function (item) {
            var valuearr = item.split("=");
            var key = valuearr[0];
            var value = valuearr[1];
            obj[key] = value;
          });
        } else {
          var arr = query.split("=");
          console.log(arr);
          obj[arr[0]] = arr[1];
        }
        return obj;
      }
      var obj = query2Object(location.search);
      var id = obj.id;
      $.get(
        "/api/enterprise/collegeDecoration/getMicroPage",
        {
          id: id,
        },
        function (res) {
          console.log(res, "res");
          if (res.status == 200) {
            var itemdata = {
              page: JSON.parse(res.data.pages),
              items: JSON.parse(res.data.items),
            };
            initView(itemdata);
          }
        }
      );
      function initView(modal) {
        require([tpl], function (tpl) {
          var phone = $("#phone");
          tpl.helper("decode", function (content) {
            return $.base64.decode(content);
          });
          tpl.helper("imgsrc", function (src) {
            if (typeof src != "string") {
              return "";
            }

            if (
              src.indexOf("http://") == 0 ||
              src.indexOf("https://") == 0 ||
              src.indexOf("./resource/") == 0
            ) {
              return src;
            } else if (
              src.indexOf("images/") == 0 ||
              src.indexOf("audios/") == 0 ||
              src.indexOf("videos/") == 0
            ) {
              return modal.attachurl + src;
            }
          });
          if (!modal.items) {
            modal.items = {};

            return;
          }

          phone.empty();

          $.each(modal.items, function (itemid, item) {
            if (typeof item.id !== "undefined") {
              var newItem = $.extend(true, {}, item);

              newItem.itemid = itemid;

              if (item.id == "audio") {
                newItem.shoplogo = modal.shopset ? modal.shopset.logo : "";
              }

              if (item.id == "contact") {
                newItem.companyinfo = modal.companyinfo;
              }

              if (item.id == "feedback") {
                var fId = item.params.formid;

                if (fId != "0" && fId != undefined) {
                  $.each(modal.diyform, function (index, item) {
                    var diyId = item.id;

                    if (diyId == fId) {
                      newItem.diyform = item;

                      return false;
                    }
                  });
                }
              }

              var html = tpl("tpl_show_" + item.id, newItem);
              console.log("tpl_show_" + item.id, newItem);

              $("#phone").append(html);
              
            }
          });
        });
      }
    </script>
  </body>
</html>
